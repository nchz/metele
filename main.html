<head>
  <style>
    * {
      box-sizing: border-box;
    }

    .column {
      float: left;
      padding: 5vw 5vw;
      height: 90vh;
    }

    .randw {
      width: 25%;
      background-color: #aaa;
    }

    .text {
      width: 75%;
      background-color: #bbb;
    }
  </style>
</head>

<body>
  <h2>Metele que son pastele</h2>
  <div>
    <input id="timeoutSeconds" type="number" value="5" style="width: 50px; text-align: right" /> segundos para pensar
    <button onclick="reset()" style="float: right;">Reiniciar</button>
  </div>
  <div class="column randw">
    <p id="randw" style="background: #fff" />
    <p id="prevw" />
  </div>
  <div class="column text">
    <textarea id="textinput" style="height: 75vh; width: 65vw;"></textarea>
  </div>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>
  function reset() {
    clearInterval(timerId);
    const ti = document.getElementById("textinput");
    ti.removeAttribute("readonly");
    ti.setAttribute("style", "height: 75vh; width: 65vw;");
  }

  const buildTimer = () => setInterval(timeout, 1000 * Number($("#timeoutSeconds").val()));
  var timerId;
  function timeout() {
    // delete text.
    // $("#textinput").val("");
    // make it readonly.
    const ti = document.getElementById("textinput");
    ti.setAttribute("readonly", "true");
    ti.setAttribute("style", "height: 75vh; width: 65vw; background: transparent;");
  }
  function resetTimer(e) {
    if (e.keyCode == 13 || e.keyCode == 32) {
      clearInterval(timerId);
      timerId = buildTimer();
      // check if target word was used.
      const ws = $("#textinput").val().trim().split(/\s+/)
      const lw = ws[ws.length - 1].replace(/[\.,;]/, "");
      const tw = document.getElementById("randw").innerHTML;
      if (normString(lw) === normString(tw)) {
        document.getElementById("randw").innerHTML = getRandomWord();
        const prevw = document.getElementById("prevw")
        prevw.innerHTML = tw + "<br>" + prevw.innerHTML;
      }
    }
  }
  function normString(str) {
    return str.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  }
  document.addEventListener("keydown", resetTimer);

  var words;
  const url = "https://raw.githubusercontent.com/mazyvan/most-common-spanish-words/master/most-common-spanish-words-v4.txt";
  function getWordList() {
    var r = new XMLHttpRequest();
    r.open("GET", url, false);
    r.onreadystatechange = function () {
      if (r.readyState === 4) {
        if (r.status === 200 || r.status == 0) {
          const text = r.responseText;
          words = text.split("\n");
        }
      }
    }
    r.send(null);
  }
  getWordList();
  function getRandomWord() {
    const i = Math.floor(Math.random() * words.length);
    return words[i];
  }
  document.getElementById("randw").innerHTML = getRandomWord();
</script>